MindFrame Quality Scoring & Logic Documentation1. OverviewThe Quality Scoring Module evaluates each person in a video frame to determine their engagement level and facing direction. It uses a hybrid approach combining Face Detection (via MediaPipe BlazeFace) and Pose Estimation (via MediaPipe Pose Landmarks) to assign a numerical score (0-100) and a categorical label (Frontal, Profile, Back).2. Logic BreakdownA. Orientation Detection (Geometric Analysis)The system calculates the orientation of a person by analyzing the geometric relationship between the Nose and Ears landmarks.OrientationLogic / ConditionQuality ScoreStatusFrontalBoth ears are visible. Nose is centrally located between ears (Ratio 0.4 - 0.6).100✅ ExcellentSlight-Left/RightBoth ears visible, but nose is slightly off-center (Ratio < 0.4 or > 0.6).80✅ GoodSemi-ProfileBoth ears visible, but nose is significantly closer to one ear.60-70⚠️ AverageProfile (Side)One ear is hidden (Visibility < 0.3), other is visible.45❌ PoorBack-FacingFace Detector fails to find a face bounding box OR Nose visibility is extremely low.0-20❌ RejectB. The Ratio FormulaTo distinguish between Frontal and Semi-Profile, we use a horizontal distance ratio:$$\text{Ratio} = \frac{\text{Distance(Nose, Left Ear)}}{\text{Total Width (Left Ear to Right Ear)}}$$Ratio $\approx$ 0.50: Perfect Frontal (Nose is in the center).Ratio < 0.40: Looking Left.Ratio > 0.60: Looking Right.C. Policy for Frame Selection (Group Logic)Since a frame often contains multiple people, we cannot rely on a simple average. We use a Majority Consensus (Ratio) Policy:Individual Check: Each person is marked as "PASS" if their score $\ge$ min_frame_score (Default: 50).Frame Ratio Calculation:$$\text{Frame Ratio} = \frac{\text{Count of PASS People}}{\text{Total People in Frame}}$$Final Decision:If Frame Ratio $\ge$ Threshold (Default: 0.4 or 40%), the frame is KEPT.Otherwise, the frame is DROPPED.Reasoning: This ensures that frames where the majority of the class/group is engaged are preserved, even if 1-2 individuals are looking away.3. Configuration Parameters (quality.yaml)The system behavior is controlled via srj/config/quality.yaml:min_frame_score (Default: 50):The minimum score an individual needs to be considered "Present/Engaged".Lowering this (e.g., to 40) includes side-profiles.Raising this (e.g., to 80) strictly enforces frontal views.min_ratio (Default: 0.4):The percentage of people in the frame that must pass the score check.Set to 0.4: Keeps the frame if at least 40% of people are looking front.Set to 0.8: Keeps the frame only if 80% of people are looking front (Very Strict).4. Output AnnotationsProcessed frames are saved with visual indicators for debugging:Green Box/Text: High Confidence (Frontal/Slight).Yellow Box/Text: Medium Confidence (Semi-Profile).Red Box/Text: Low Confidence (Back/Profile).CSV Log: Detailed metrics for every frame are saved in filtered_data/annotations.csv.